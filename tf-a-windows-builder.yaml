- job:
    name: "tf-a-windows-builder"
    node: "tf-a-windows"
    project-type: "matrix"
    concurrent: true
    disabled: false

    description: |
      Trusted Firmware A (TF-A) Windows hosted builder

    properties:
      - throttle:
          enabled: true
          max-per-node: 10
          max-total: 10
          option: "project"

      - build-discarder:
          days-to-keep: 15

    axes:
      - axis:
          name: "DEBUG"
          type: "user-defined"

          values:
            - "0"
            - "1"

      - axis:
          name: "label"
          type: "slave"

          values:
            - "tf-a-windows"

    builders:
      - shell: |
          #!C:\msys64\usr\bin\env.exe OSTYPE="msys" bash -x
          make -j $(nproc) CROSS_COMPILE=aarch64-none-elf- PLAT=fvp DEBUG=$DEBUG V=1 all

    parameters:
      - string:
          name: "TF_GERRIT_PROJECT"
          default: "{gerrit_project_prefix}TF-A/trusted-firmware-a"

      - string:
          name: "TF_GERRIT_BRANCH"
          default: "master"

      - string:
          name: "TF_SRC_REPO_URL"
          default: "https://review.trustedfirmware.org/{gerrit_project_prefix}TF-A/trusted-firmware-a"

      - string:
          name: "TF_GERRIT_REFSPEC"
          default: "master"

      - string:
          name: "TFTF_GERRIT_PROJECT"
          default: "{gerrit_project_prefix}TF-A/tf-a-tests"

      - string:
          name: "TFTF_GERRIT_REFSPEC"
          default: "master"

      - string:
          name: "SPM_GERRIT_PROJECT"
          default: "{gerrit_project_prefix}hafnium/hafnium"

      - string:
          name: "SPM_REFSPEC"
          default: "master"

      - string:
          name: "RMM_GERRIT_PROJECT"
          default: "{gerrit_project_prefix}TF-RMM/tf-rmm"

      - string:
          name: "RMM_REFSPEC"
          default: "main"

      - string:
          name: "CI_GERRIT_PROJECT"
          default: "{gerrit_project_prefix}ci/tf-a-ci-scripts"

      - string:
          name: "CI_REFSPEC"
          default: "master"

      - string:
          name: "JOBS_PROJECT"
          default: "{gerrit_project_prefix}ci/tf-a-job-configs.git"

      - string:
          name: "JOBS_REFSPEC"
          default: "master"

      - string:
          name: "MBEDTLS_URL"
          default: "https://github.com/Mbed-TLS/mbedtls/archive/mbedtls-3.6.5.tar.gz"

      - string:
          name: "PARAMS"
          description: "Debug parameters for make"

    wrappers:
      - "timestamps"

      - timeout:
          timeout: 120
          fail: true

    publishers:
      - archive:
          artifacts: "build/**/*"
          excludes: "build/**/*.o,build/**/*.d"

    scm:
      - git:
          url: "${{TF_SRC_REPO_URL}}"
          refspec: "${{TF_GERRIT_REFSPEC}}"

          branches:
            - "${{TF_GERRIT_BRANCH}}"

          choosing-strategy: "gerrit"
          skip-tag: true
          shallow-clone: true
          wipe-workspace: false
          honor-refspec: true
          allow-empty: true
