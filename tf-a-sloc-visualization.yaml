- job:
    name: "tf-a-sloc-visualization"
    description: "Generates a visualization of programming languages used by the code-base."
    node: "docker-amd64-tf-a-jammy"
    concurrent: true

    properties:
      - tf-a-ci-scripts:
          download_server_url: "https://downloads.trustedfirmware.org"
          download_server_tf_a_url: "https://downloads.trustedfirmware.org/tf-a"

      - build-discarder:
          days-to-keep: 30

    parameters:
      - tf-a-clone:
          projects: "trusted-firmware-a,tf-a-ci-scripts,tf-a-tests,tf-m-extras,tf-m-tests,tf-rmm,spm"

      - string:
          name: "CI_REFSPEC"
          default: "master"

      - string:
          name: "JOBS_REFSPEC"
          default: "master"

          description: |
            tf-a-job-configs refspec to use. The master branch is used by default.

      - string:
          name: "TF_GERRIT_PROJECT"
          default: "{gerrit_project_prefix}TF-A/trusted-firmware-a"

      - string:
          name: "TF_GERRIT_BRANCH"
          default: "master"

      - string:
          name: "TF_GERRIT_REFSPEC"
          default: "master"

      - string:
          name: "DIRECTORIES"
          default: ". ./drivers ./plat ./tools"
          description: "List of directories to analyze."

    builders:
      - "tf-a-clone"

      - shell: |
          mkdir -p output

          cd trusted-firmware-a &&
            bash ../tf-a-ci-scripts/script/graphs/sloc-viz.bash ${{DIRECTORIES}} \
              > ../output.png 2> ../output.tsv

    publishers:
      - archive:
          artifacts: "output.*"

    wrappers:
