- job:
    name: libtl-patch-gate
    description: |
      Main entry point for the Transfer List CI pipeline.
    project-type: freestyle
    concurrent: true
    disabled: false
    defaults: global
    # TODO: check whether we have an orchestrator node for this.
    node: docker-amd64-tf-a-jammy
    properties:
      - build-discarder:
          days-to-keep: 10
    builders:
      - trigger-builds:
          - project:
              - libtl-pipeline
            block: true
            current-parameters: true
            predefined-parameters: |
              URL=https://${GERRIT_HOST}/${GERRIT_PROJECT}
              REFSPEC=${GERRIT_REFSPEC}
              REFNAME=${GERRIT_PATCHSET_REVISION}
              BASE_REFSPEC=${GERRIT_REFSPEC}
              BASE_REFNAME=${GERRIT_PATCHSET_REVISION}^

    triggers:
      - gerrit:
          server-name: review.trustedfirmware.org
          trigger-on:
            - comment-added-event:
                approval-category: "Allow-CI"
                approval-value: 1
          projects:
            - project-compare-type: PLAIN
              project-pattern: shared/transfer-list-library
              branches:
                - branch-compare-type: PLAIN
                  branch-pattern: main
          override-votes: true
          gerrit-build-started-verified-value: 0
          gerrit-build-successful-codereview-value: 0
          gerrit-build-successful-verified-value: 1
          gerrit-build-failed-codereview-value: 0
          gerrit-build-failed-verified-value: -1
          gerrit-build-unstable-verified-value: -1