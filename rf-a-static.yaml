- job:
    name: rf-a-static
    node: docker-amd64-tf-a-jammy
    project-type: freestyle
    concurrent: true
    disabled: false
    defaults: global
    description: Run formatting, static checks and lints
    properties:
      - build-discarder:
          days-to-keep: 14
    parameters:
      - string:
          name: RF_GERRIT_PROJECT
          default: RF-A/rusted-firmware-a
      - string:
          name: RFA_REFSPEC
          default: +refs/heads/main:refs/remotes/origin/main
          description: |
              rfa refspec to use. The main branch is used by default.
      - string:
          name: GERRIT_BRANCH
          default: main
      - string:
          name: GERRIT_REFSPEC
          default: refs/heads/main
      - string:
          name: TF_GERRIT_PROJECT
          default: TF-A/trusted-firmware-a
      - string:
          name: TF_GERRIT_BRANCH
          default: refs/heads/master
      - string:
          name: TF_GERRIT_REFSPEC
          default: +refs/heads/master:refs/remotes/origin/master
      - string:
          name: CI_REFSPEC
          default: +refs/heads/rf-a:refs/remotes/origin/rf-a
      - string:
          name: JOBS_REFSPEC
          default: refs/heads/master
          description: |
            tf-a-job-configs refspec to use. The master branch is used by default.
      - string:
          name: JOBS_PROJECT
          default: ci/tf-a-job-configs.git
      - string:
          name: SHARE_FOLDER
          default: /srv/shared/${JOB_NAME}/${BUILD_NUMBER}
          description: Folder containing shared repositories for downstream pipeline jobs
      - string:
          name: CLONE_REPOS
          default: tf-a-job-configs,tf-a-ci-scripts,rusted-firmware-a
          description: |
            Optional arg to clone only specific projects from default list (tf-a-ci-scripts,trusted-firmware-a,tf-a-tests,spm,tf-m-tests,tf-m-extras)
    wrappers:
      - credentials-binding:
          - ssh-user-private-key:
              credential-id: TFA_CI_BOT_USER_SSH_KEY
              key-file-variable: CI_BOT_KEY
              username-variable: CI_BOT_USERNAME
              passphrase-variable: ""
      - timestamps
      - timeout:
          timeout: 240
          fail: true
    builders:
      - shell: !include-raw: scripts/clone.sh
      - shell: |
          #!/bin/bash
          set -e
          cat << EOF > env.param
          RFA_REFSPEC=${RFA_REFSPEC}
          GERRIT_REFSPEC=${GERRIT_REFSPEC}
          GERRIT_BRANCH=${GERRIT_BRANCH}
          EOF
          cd ${WORKSPACE}/rusted-firmware-a
          # Executed project-related static checks: copyright, unix line endings,
          # formatting and lints
          IS_CONTINUOUS_INTEGRATION=1 ${WORKSPACE}/tf-a-ci-scripts/script/next-checks/next-checks.sh
    publishers:
      - archive:
          artifacts: rusted-firmware-a/next-checks.log
      - groovy-postbuild:
          script: !include-raw:
            - rf-a-static/postbuild.groovy
