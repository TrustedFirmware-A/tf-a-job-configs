- job:
    name: "tf-a-test-category-visualization"
    description: "Generates a visualization of TFTF tests by their test group and category."
    node: "docker-amd64-tf-a-jammy"
    concurrent: true

    properties:
      - tf-a-ci-scripts:
          download_server_url: "https://downloads.trustedfirmware.org"
          download_server_tf_a_url: "https://downloads.trustedfirmware.org/tf-a"

      - build-discarder:
          days-to-keep: 30

    parameters:
      - tf-a-clone:
          projects: "trusted-firmware-a,tf-a-ci-scripts,tf-a-tests,tf-m-extras,tf-m-tests,tf-rmm,spm"

      - string:
          name: "CI_REFSPEC"
          default: "master"

      - string:
          name: "JOBS_REFSPEC"
          default: "master"

          description: |
            tf-a-job-configs refspec to use. The master branch is used by default.

      - string:
          name: "FILTER"
          description: "Optional job/group filter string (e.g. <code>juno</code>)."

    builders:
      - "tf-a-clone"

      - shell: |
          mkdir -p output

          cd tf-a-ci-scripts &&
            bash script/graphs/categorize-tests.bash ${{FILTER}} \
              > ../output.png 2> ../output.tsv

    publishers:
      - archive:
          artifacts: "output.*"

    wrappers:
